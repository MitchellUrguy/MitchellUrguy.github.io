<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; background:#f4f4f4; }
    .calc { width:320px; background:#222; padding:12px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,.2); color:#fff; }
    .display { height:56px; background:#000; color:#0f0; font-size:24px; padding:8px 12px; border-radius:6px; text-align:right; overflow:hidden; white-space:nowrap; }
    .keys { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin-top:12px; }
    button { height:52px; font-size:18px; border:0; border-radius:6px; cursor:pointer; }
    .op { background:#ff8a00; color:#fff; }
    .num { background:#333; color:#fff; }
    .wide { grid-column:span 2; }
    .clear { background:#b00; }
  </style>
</head>
<body>
  <div class="calc" id="calc">
    <div class="display" id="display">0</div>
    <div class="keys">
      <button class="clear" data-action="clear">C</button>
      <button data-action="back">⌫</button>
      <button data-value="%" class="op">%</button>
      <button data-value="/" class="op">÷</button>

      <button data-value="7" class="num">7</button>
      <button data-value="8" class="num">8</button>
      <button data-value="9" class="num">9</button>
      <button data-value="*" class="op">×</button>

      <button data-value="4" class="num">4</button>
      <button data-value="5" class="num">5</button>
      <button data-value="6" class="num">6</button>
      <button data-value="-" class="op">−</button>

      <button data-value="1" class="num">1</button>
      <button data-value="2" class="num">2</button>
      <button data-value="3" class="num">3</button>
      <button data-value="+" class="op">+</button>

      <button data-value="0" class="num wide">0</button>
      <button data-value="." class="num">.</button>
      <button data-action="equals" class="op">=</button>
    </div>
  </div>

  <script>
    const display = document.getElementById('display');
    const calc = document.getElementById('calc');

    let expr = '';

    function render() {
      display.textContent = expr === '' ? '0' : expr;
    }

    function append(val) {
      // simple guard: don't allow two operators in a row (except minus) and only one dot per number
      const last = expr.slice(-1);
      const ops = /[+\-*/%]/;
      if (val === '.') {
        // prevent multiple dots in current number
        const parts = expr.split(/[\+\-\*\/\%]/);
        if (parts[parts.length-1].includes('.')) return;
      }
      if (ops.test(val)) {
        if (expr === '' && val !== '-') return; // don't start with operator except minus
        if (ops.test(last)) {
          // replace last operator with new one
          expr = expr.slice(0,-1) + val;
          render(); return;
        }
      }
      expr += val;
      render();
    }

    function back() {
      expr = expr.slice(0, -1);
      render();
    }

    function clearAll() {
      expr = '';
      render();
    }

    function evaluateExpr() {
      if (!expr) return;
      // sanitize: allow only digits, operators, dot, parentheses, percent
      if (!/^[0-9+\-*/%.() ]+$/.test(expr)) {
        display.textContent = 'Error';
        expr = '';
        return;
      }
      try {
        // handle percent: transform "x%" => "(x/100)"
        const safe = expr.replace(/([0-9.]+)%/g, '($1/100)');
        // evaluate
        const result = Function('"use strict"; return (' + safe + ')')();
        expr = (typeof result === 'number' && isFinite(result)) ? String(+result.toFixed(10)).replace(/\.?0+$/,'') : '';
        render();
      } catch (e) {
        display.textContent = 'Error';
        expr = '';
      }
    }

    calc.addEventListener('click', e => {
      const b = e.target.closest('button');
      if (!b) return;
      const v = b.dataset.value;
      const action = b.dataset.action;
      if (action === 'clear') clearAll();
      else if (action === 'back') back();
      else if (action === 'equals') evaluateExpr();
      else if (v) append(v);
    });

    // keyboard support
    window.addEventListener('keydown', e => {
      if (e.key >= '0' && e.key <= '9') append(e.key);
      else if ('+-*/.%()'.includes(e.key)) append(e.key);
      else if (e.key === 'Enter') { e.preventDefault(); evaluateExpr(); }
      else if (e.key === 'Backspace') back();
      else if (e.key === 'Escape') clearAll();
    });

    render();
  </script>
</body>
</html>